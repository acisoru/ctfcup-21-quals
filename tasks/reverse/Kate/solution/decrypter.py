from Crypto.Cipher import AES
import sys
from binascii import unhexlify, hexlify
import struct

p64le = lambda x : struct.pack("<Q", x)
u64le = lambda x : struct.unpack("<Q", x)[0]

first_packet = unhexlify("e507090003001600140023002f0068016dc0c81164828342da7501596132b3507db981dc3f261281078e92199edf1f37") # enc SID
second_packet = unhexlify("f967b47b9547d3913bb5f7c1bef4d16ec19826089ec3be2949179221cb42d5bc3c01dc2b729c0fdaac892534882c9f91564d98edaddc9980785edbc0aec539745ce4a153dfd33c7718a043d46417c4d351f05d10725823a43b7c17ed743c9d2b832dcd192fa6c3092f229ecd3c1373d6362cbeee5a79012f6d2be398b41e01b0a5bbb75710f20a22dea241937da34167a00d06a7f155412f730d240e19f2ace686b2e9b20154eb1e9cf0228760d3e6a70d4517e6596fb482d9e07f43db744acbe47996210085b5fad5abada4e816ef5f87903c9f1aea89cbd1e340332a5b317afe2f888491cd1e16ca8be27f7a270581930b1e7cb2c29df80e996e130228bbb6de4bc51de776005728eed7c4a70dce6f9d5a8e95a9c26483a51af0b41b81f6c958ae40bd6c458665654a525f637e784c16e4ed220b2dd97141c5fb6e1f4358455e463c1d7a83fbd843e2eed56aaf0845e877feed724822a04b9cfd92cc7307e07a1b3d7d48b1693ca0695637e3eb3eda1f529d116009f5c9ce7c9e7eeaae6ac08bd95fa39e33b92c34d6373d26f9ce15330145986885c7ae3d8726d8496c8d98a545991005ebaa6062c1709baacce0da6f072757b3448409672296b6d1a80cef75975435f335873d125c6f88ac52cddb4491c3c91580e267a7b6d5b4c65e05620ae575da4e77aa907b399dc01a3855fdf0de4e16d9ecd33605ec043b84024ee530321bbd6502c9259aed1bf17422a35219ecaffdb3827a51fe6199b461281470c8614d32e59e97e05e84e73631d463c7f7c33ed44ae8d4f43f4c17a15820014fea47a98b9229cc479e1b00a4a8d19d779ea76729ae8b14faabd6261bd143733ec44909ee9ef3f1e14c6afa3964ad9d8ee22c827ad71e4b21bb2e72ecdbc7cf5cfba60d904918432f070fc7b9e6b7a40501a3c56e343287ffa79f76bf117c551192b4ae1ae6ba21fdcfd6be4644ab14b1983fa591a3a196335b0f01682ca5bd441e64630d7a93d71c810017a13366542ab62e7ae5a5367bc9b9dd7f17292383edc7f946a03afb5b71d641b81a1974209b57c02963b9536d7ecd51c56e5643a41c78fa43646d95e8676e3d129bc66d0a572a9b633af820de053946196e9914ba063778869cb25b78b4a2ab63f484f20f18fa709bb96f7e7fe5e926ef9b8336e2e71505a0273506fc4abc3b4a414f4c992c4f77182ebd65c69f172d3d9053a0f8dba9ff25038040db4d91b4cb4abca5e9f584e51476551104a0efb72fd2af39a94bd5d5f28f36f609ae4ac5c8bec2cbf60dd3d16baf083f180a6880a0d4183c4f70c8c60bc4f1ee70003c7d68b97c748bce935764c0c971ba26cd82a30bb94c13f4ef5eedc4bcafc2ee1b4385ef8951f486647488c6ba1680b4aca6111340269f7cb463986d085215cf65e0da14ae649f81d3f73a947d4db7c4f188c10bba0cc27435445601a18615f98fa29ce2c828bae31224faddb8e97a7d1149dab3abaecfd8deb22fba1db5100ae8038536f02b0909d123c1c664dcd4e3c95ea3b212e72c2e4d8ee213707595512d6bd01c4282f7fb91c8f10c896a88f6f2c05dd2e6570e7a08756eaa034b78642648594279ba0f5ed812bba53c6ced774ba99c58bf9e3d43feaf0b4016d554ff1cec5837d88b5043c0c3145cb51423f1281dda6200d3b825b31cd659b943dfb17311f48d220ebafb3f978b91b7d24d2778416721fffa3ef54ec43acac20a3c9c0981940ed42ce0660fc41bad093db52c81279911a95519849f1186d67332f20257da7cabef2daafca6725892e7338309bcb779a0fd7acb47b9a60ba4f9e6695be67fd04a85eebcced92c007d138bf54d040b13588cda0d0652e29404039b36a4d8181b791a9010b68d8e977bffc5a04bd706446b34d1e6f425e2252c35e3f5bb8f64fd7b9f5afde5d5715525cd612ad830c2a9a6ffed9c57a000c111a3de6ea9f9436daebdb0c2f561452427539e5efdebecb0afec1ff0cb43d97da2d317c2ceccfae1967dccec0a4013e04954589afacc8c3edb1222704d5c18863cc0dff305dbcea7acd39c16daeea3fb6d1d848b54b7ba754bb7a233a0ac067507f0df58b2e92157ed6f8e574a99e001bdb20525a58c699bcf3d278eddb6a8b823ca40dc01b6274ff7085183b49aeb6f333ca0c4cd4e597a0b1f14368ef9027e5b1805894cfe7718b0936f9ac18090d94ec8a364b2b18bdd9ac8d4b4bff13996301e6c3c7a0403ff4cb83e61d1575a4f146a82e6809722da30514273d3555cd4d96ddc39304f4c0ae2c9631326b4f1f478e40015e5685d2c99337db90ee243812b691a9871399b47f2d3f812b8f7d5dd2b81b9ca0c815cd32b63dd8e813c2756a2ac5219a81f0642123d3152cc7298d3a03d050af85d5922ad0100a03a6b9d6998635c1be70a42b6a65b73707dc2bef2107c80c1e67d37c2fbd4623e17af3171cf5e68d6c739cfd75816c173c821951b803fe12919533a8b1721c82355640ffeaf5f67feae5c41c5266a229dd7053455dd3841c78b53254f51b69bd01ea4f44a7a9bcdd6ce169fa5261b61de3e246da76e93d00961f9aa789ef5c8ebd4cd6e33455f2659736319bd9ac9a7340c9610e2361d7eac7f574ae739178ddd4feebfaf95f2255cb53a573c445dba6ee5196aaaa65679b84574b5f3986834051ea4a181e9fedc06c9b374e27db95282ff3a1c1ff4f239dec980d0adf94bfeb6ff5f4043606ce45bf50e3eae0892fd39dc83d2cd27da20f3d9fc70738f893ecddab627680f66f6e0f5d15e71a2bee4ec53512bb28a37cdcb44154f167ab7b0b7f926be959dda86ace49d0094316c47857b9e8179a6358b715941624c9009d8137f83868783c6cf589096fc5f6a81eb1da094969651b9f5ae548fb83749f5e4650c74e63d25011300bc74e04cb12cd89d9a4797cf3eb06464dcddaba61e39c3d5ba62d2531332c4181574dada43e93a175c7923bb92bf3700876ce50aa197c332e4654e06d36979455be37ad340bcbc1db627e57ff4417f6aadba2133027e72766b97d28cd500ba3ca4ee4fbc51525221f6f0edff933d9dfcff2e61f337e3aa2231d61bcb4f370f609c1fbc2a0b31f088cd6ba7fe385377ef014fb062992d98ed5a982177cf3fea8f80bebacb102f2526c19d093e6b0e9290e9bdd5d9a988cd7794c1569a8038204a5ddd635906b1a4cd0d252c755995959445107373bf6f188c68b1c17588db2478ab4d3f77ce445fd72f864e98e5c5d1fb5919ecf4ad8a8abcc0fd5f1b63803d063128cdd8fdbc87f1d9f61a1998af35ee386381d31fa4db95dc06b15c04526cfae63d6a2c8d0f7cc0a035c4415d4057c14f8aa2f2507e41c2c3bb2c54a4b22db5ca8e3e7e3902327099fdb9d80e9741daccd2082dacb81f54671179bfb4f5809703469d8289049024421e62891093f1b5a6b62e9e8ae4de95f72764ce7f3fec1d8dfe48565538d3cca96fa9e273768118368e0c3e7c2252bba2f681585f6dd496c44dc945e54bfe0a5c508e8a0cd8696a637796b758662c1d3347a92b1c958f5cbe5b245f214ed4a5b8b378f90c7b321cce3a6ce0e9b91e288353e0a1d88ac125b47f56f88ce41ff09aa908a3a6e1a115deebd70f8743efc1ee23c95dd9957004fdcb009f308d2bdc6a4ac2ddd79f003ae17c4a26e75bd86ba465a11ad9af7888098e290987012109309b37ec246db34c17cbedc2ef2a0ce5a62fbceadd3265afeba6d26d9b7fdae47d0714d4e7b2af32b1c1c554e33b082bac1aa35811bf5a0d88524a43098a691cc5231aee0f2e4fd70439ac292d4ab979f5d54f20197fd694242ec10b665c82efe6d8cf4b08e293d428584c560f45aa0aabda1ccac1ffdbaf8f7abcbcc99fccf570c99623be10a9b5221c23dd20d355bfd438ac842001a6fa4200ae1fd834deabefb335f14b7c32e25462b80750b4e1ee0fb888afb1cffe6bd7d58e492eeba90e977e7cc576954a8f6c6b2998c21cd8ca1a8af59f5c6a8be675c43198edf26e696c1e07ea87f5df88187849cd52abe1be22728dac1f9d1652f1246e0695c2d429d1887c20d84da03c2a0143e619c70313b31432e526ab8eb331b185beba5377f97e4d671686361dbd75a9ac87ccb2793c41fb3a8dee0fc3a7cd75b81da3d5c50d5265f600fdd62963611fc80e2e395bb08e6efcc8b23c8c46d099ea2c9d5e9a7d5cf502394ddb98d46cf53f87071de028d260337819b20dda7ccb4ea33c4af7bfdf56b3f720c8e3f00efb83a19660f7c3378ba601f102e390add605fed3ec95f4847a2d70838b0ca8e765fbac079a25b691242d23ac7f5c48b8c8200cb3c3f49732a395afda409eb4ddb3c936e2adf38fb6210a408c5d99d39058cb4e0a5bb185674f42b30f938a0e8691e5c7ed6c75c9f15ed9c42fd0032699293f25c53abe6591dfcf1f9bf80702e830e6d7adefc3534b26732d14482e54d0a006e5ca03b96b13b834057cbb49db94be66c3cb8f8e9299449dcfeb7af4e3d4d660b65fb046681726aebc1aff72b2eb41bc4013e1da1bc0e004af8ab4778d96189269fcaab5f288cc01f80cadcb9e7b9f1dec2dc91d9128a29a92304ab382c781571577bb4da0221dc5cb7d7a38380a41c1cf472734bcb74c72bdac0439daf34f469b112b95d047f687e3e6bd44e517ae6e6aa922527a9ba550f57e431822afe04ff9c879e22f837cc99ff4f3f03fdafa622e30e266199c5757a05b3dd2d42cbe0be60f64f0123f9d964a670b6b51045901f7866e32c98bd62346662fc73337178e3c3f430f4b66ccf04c2e8ff545d18be47591514a096228734636eeebbf263c82cb2b2bc8487f18500286c9e99171bf93288614923945c05bc8ed99ad63a8a9cfb7cf810b783a53406fb485b3fbac00a36d80c8ceb137f4c04897f9f77d011dde9560ab650b6f1343b1c304c8723fb40c6cc3724f4af2096e3153d9ee9281e8276fbd1e810bf0e4016914933c89245e19d981876d8875e4b854fddffc56d1c7494cd0ff9e610c98df488b02aa58451e8cb1cca732a74bf2bbaa0a5777210c1c64fd6205e2ff4df91f8b6a0d6a18faf1d29f1458574c787abf1c5411d83f9ca709bbbcaedb2043309a27c1d4ba22c7077bf9de15cee920c731cd581273ba44e2398aed8187a2c76269b279a8748013794695b8257832134aa198e5636e55d956237d9768832014849b2cb16c676d7f5e25b9d85ef7af2a90f666d356b1b81e00bfd456f370d95f6c01d66fac0ac5de96549c468f80fd571931d57d49e95426547c0d34acd40fe4719f99ddb200b105de2ed18e690da19bcc9f8251486b03001b5db11b94d403e8f0810d461230fc7a7834c4168bfbaafa8704b5de91fed8761abd4a7540288c789273d52d66ca5e9563a5397abc963f2d785b4541675761d73abecf1e21741ea3c4cc72a93fa976f6256dbf1e9227696b078965590225b58f274aa80deca77cef425925625c485d753e5f5432b1ce380fa05b8dd1fb344d9e910240926887b7483693ee64263c207edfd5583c420bf999f4ab0f36e47dc854ffd65f76a54d36195371c06426f8ce0fbd3486a51d4c637fdf6e1abe34da78c5654338b1ebebf69106007c1d0ac131489ad8d7258e71e64815123e1dbe177252581110e6ae4f68c680a042ba3d5570e831700358b8b74753be7824676b966e6a58d62137410cffafee321e93e6ec6b0c4c3866f80a7ebb8998186a7252aa838587a09c9fc3033c82f7fa06f89862d39e45f4c2b74230b7ea514c754a3feb8608513789df3cf2f36c7dca087faaa420caa91e5d1ec30dde8020c287f7d2bb1adce3a0be1862907996f8f056ae52031131c11c33e86b533645566ef49b0ae438a309bb3c33e4b1ae038fcc7cf77e34ada7281aca4dd2ac6f4433ca359251de640f4441ec8d8aa5bb893ecaba25f0027bae98cceb82fc240adebdd43c71b14848f07575aa6632b6e972438f72f7dcc52ef9c49ae1b9f9224f0abcd8cd0bc564d75b3dd13956cbff5e7fd1280cfe9302e8041a299db874c11d6c5af6121b75069c1546b92abf2ef518b8088e63e16c6ddc0ff30b31942eae0bbe7039da95e17548288c9915e9aaecec39e81b237471432163b9ed6a0699e0a46c28a6c6e9bc5b2c432b80fc9b066e3e4a199dd74583a20ae7ad4138f479af2b3cff48c88d84d1972e41452de9c0484f478b097a72698b1929a62eaa6dc839a1123e677e0d275e1f910ec12204f3a27915c18708a420931168f67c070a31744d318fecb6d687b0bc71d7dd3de07db46aa4a8ecc73b934885f9ab6a25bc13be84c427fd673c2eae9b8310849a24e681c0fdcd97d21f62cba87cd1b1d8a9c815ec7e5a626203a23a251b809aa7b5bee0ce9573e1f2fd85ce8cb3987c8ae7ea015a28475bf5686a0b9ae641ff4caf72856f33d2c98712227c68cd3501948a732de36c4f6df4103389dd60f0a3b761452c788db203dcc1b119b24ae8f31a16c7b98e3517503ec44d5d08f57eb8e62f215c85ee2dfa631dd56626064b0ea8f1f5f16a609598749fa1818a19c915f2bc0c33f31fbb732c9d6e5b888ecdda90d11d8911dca975aadcd855d678100b23ccc2793139d94736126e9b3758a9adb0438cbe02fb9b187224c13a1b31da90d9448a01f95881f2712a92b3e08ede0e59cc9c84e1999333fc528bfb00f439a2f79645be45de75bb23875feaca6d7c257b37955b54388099d2e0eeaa29227548240d65a058399a807a5dbbdf902436998235b5e895df59f40a4548a27e535a75d8551cdf7c24515f2b0cdf9557ad24cf02a35eb3d1bee7d4ebfac6fd3368f405297d0403b7f487ad6ee9079f771450854117dd46b1c7f8d0489c9b016e0f4ccf466f4272ec4133c2fd68732a07382af090edfcbf086bd9a4a5d5a09694da4efb286c0b5d700dbce686a64307bdaeb8666f03e3334e5cebe1314b7d392cc5cc39d85e5c857e69c9dcece4f594de7c556d71e6555a75a150c39bfb69feb5a792eab6a13485a053d1b4f63b3586b3b967be2ac11defb2229b083b83b3c022ad26a24bc595a5fbb49b72988bc44eea166a17bce24b7510e4c8b4c7f274f78940d9f23554d2fad583ec7f4b0f0aa0a23d7c7213f8d57e85fa5640cf0faf9bb15d3870be259ed79e5880183ef34eb04a34d08f761e079779d4d3e1938205e6f83b273f9276e00d54cd09bc7776ac24036d5b487bd396b4137e03fdcec892aa21881cb3e39f53837b7016bbae1776232fa298263a27be574a33b5d2bbc59a2361f247b789f0da8e13bc9711cbf99b4fa22e19ee94fdaf05f6d3b79a034591b57613dc291543b08600c5837b7cfb005174a21e5f9e54fa077593a40b76b6104e0e0a5194975c8c1e0590cf437327eef3f7532369c89ea84ea86faab3dea3aa2fb222c5511dce91c1278b2a61ccb193ceeaefee0ddcf40e93558f75147b244a05e73da11f7f27cd781f3b0de58b403b2bca2374fa1462c07b5d6572dafb3740e60b945957c01888a5109f62ad29030aaf419809b6a491bf98efd42e14ba07d4dc4ad4ecb99d478196e12ae8c6b3954ccea0d7974dcd3209c7b75c17d1c21fc5aa4fe5f728dfec797ea31eaff34de309db372c1a506b9d49c254802513ff6cafa5be9e1520d917e1bd59b965813dde780a15919485f7cb2e9f624c12dc26f228887c9acd95f2c53c69727ef2691bfd9a6d5c6a9c4f23dcc9e22e1c7cf00a26e835e0278ddb489fbb07832d7891b3b7de8333ef9fa80dc15895443b89f0908504c24f535d6324add3b4c4528c770ae7893ee92ca7add454da448c3426d9621f02b6c1337d20d571d69e11bd1cfbd90b7030aa8c9a8f519658272258b99e221e2fcaed226ceab64350fcd1204642b8d746586cdb145d23b2a8426a533e8b057ba90a3f2332b6e8eed58f69f741e9e65d30bfefee8f5a60f191026b98bfe531ba7b3baa161ddd21f2aedf13b4bd412bc7e79281b0704195f40e8b9fb9a5e87c9d2bc612d54fa4400a25f03491ab91efbe34aa6b4a2e39f6582f352de0989da7e9aad7b8a92164b093321d9527dcdf5403e508b84a17c5a667a2926e12e97ef3c3cc84ea3fc4007bc70bb2db36f1a2cb0fc145bd46317ab4134a402e81e121c3d783bda6b6a2d0d6479932c827f2021305eb1a438c5ca197f23b82b82628ea89a87891a622b3ffd8cd9071882eea6561264e344b541200d81c73f793582b111c471e913788c887e8a8da286b1ea0236c83ecb128a36472afeb308f725c04e356c7d9ce5a8e7a4c0d0241dee7dd493e11474b6d1f1162cddcb186d056a5009694611ec8d3c212d525fbb776daf22676265156f409fe8fccbc5faeba37bced3046ac460ce9ca79140b391ba5b08e5a3fb103c658b57dfb40753fea1455fe08c7e8085b26ac4ae6988a51fd9a6653b771bc4240c48dfb0b0768cd228594c707e62e86cf8f5fd887e51f958267c103f5a344e399ec9b76873def235a2b33425fd523ccba4c46efe0707e5cc73759d62b2980e702e5ebaa457c054485ac064c05b1c0eff6870fa7d3284e9579022fb0e685a9a21b3ee29ad348a1d5775e473ac590c2f67459c6e46ec8675a5c26456b7bec791b92ec320f84e1f7ab3106265b2638befdf30042b9b262fc66b522bddae6ea0b418492ba17b9b2842ac1830f426776f5905b93976a43437399c3974a3c7a5e843fe4f86c33244b9476db480d88b3f2c3be5277585488ab695626cfdb069ad368a5fe5a830da7d7f87e525d8f0df821f0b6556dfeaf81384699daa0d39f1ddff86e10a038c834d12a453485e744dd68fb8f8f27c0287886e13a45de7d22ffbe4a5ee69596d58b97872bb41b3e1e9a61ebbd798448add2d8fe1b5c8f0e16d789cf7004774b01fba023047de4731cbbf0087560700644c9a5618945c29ff50d13612c7ae60ef0fb74f05d5d2121cc3ca863d64c9b3529272db51888861566d6e4a14b3bc337f3159c29109a9f9441b7096953903859161e229a6cc83927e8925f2c8e26aa8f76676e9dcd6d0e50b7a08692d4ace0764acbb92e26eed6b556cb3af045b993ee77786dcd0a085f6d5b9c8466332bf42e326651cad4b51ecf7260ab612d554e1f13745b5f80c97683bfb56603cccb4005b888784e977f0af554bfeda4a71b572e1db209c97110e23bf2637be691e6d505cede573ba599e034b9bc033b1f8bc224638ebca0b8cf714c45447178ca751016e9f77490f5bf61e9f260cfec3169b8fe9f50fc298be70e837a89a39d5e9b8744cd563b0c81a56b9eb1092470fa8e156e5717a24b0f987fbcfb4dcd6914a1431de27047839e23785463d3db5c3f978b5ff491c37ab81c36dc0d7099e6544f5c8c32f3c26aa288e8e0850cc8994e394d7f5a55d236e9e0ba53651f7469ea2fdd26e8c82e0454512742d5cbfc9704b4499eae3f501b15228a129ae2e8ab2876a5c3594525ecf0f32ed1b9416c46a9da1f9323b810c3cf1f9003a5b37f77b3055fb514cc56c9942c1dc3053d96d20b720987e4b708ab65c9969fa4fe1f12608ae88bdd6d1182b177712ef92b25db63de2b3f2f747ace474675a662bb698eac7bbe40e5eee4c9804c31d3a11eb8569a0886e4d8c0cc75fea03b4cb3589acd63dcc6fc6b2e2f892e618db3b0739bcc2669a8bd0f00d2fa522e165d32ad88147a66414ea832cc86a083c64fc1e0ce973f8f7c28588d6e42178650336e5e94bbcc71f0264cb0c496bebc8571dbfc90ec6d508e97e09c1547036e70ece1d9b52d54a3993afeb12bdf44b494c1b13e0b84ebd6eea5cd86b751d6936dcc2884a7ba59079510df57556612c81f6a4fb51baccbbae1890b9aed49bd58e72bf79c88867c1a8da10e6fc50697a4aff70879cccc6f45cccf4aca2177350e87b858af19f80f5cc706702745dcc79d48d2acafecf9c012beaca83478adb6951c1f6474579c3f3e88d17fea57e4a476110bf6d09968106f8995d652d4914187003997b782080a1e5780ed564c3920c28bf4fe488d55d533c2932a151b2de2334b98e45917278c38d9cd6f268794bc214b8765dad73abb8daedb26ef5f304dc4d6fa21de005d7afe2785915c2fa4d138f061145b410cc5bcd81d1e69034e5d2d4440e82a880fb431ac691e411bc564b318f4041d0cf58a1cfd5e65532ba0bc457f1195b36898e0b59f29f91ff1cdaa600c436dc40c0c753498a5db12d589bee5fa23d3c52c8939b1d3475d49becf7e5c328ccc0ddd2db6cecf0040fd0b15b2b51ccc60d52752f53e6b8c9c4bca82753c7758d42c957534ba55e17428458d3ddddcfa0339a891c9c2280a56d39fff79e9e76d63c8a1196166c445c8b4d825cb60ad6b97c4db4039eb5fc270f81b106fb4480229b2c580ef2c8f81087f8ddce4d247727b133847a04574051359b8bb4b622786be7ca28b1d99c3405bf7dc3b1aa80d0189d770038997d042664c9dc1c0eadada993b99b26c78b7303ace66b1810e0a044c074f596ba41dab3ff8c8088a147f93de029e12541d611a0eacb5dea2c5cb878ed645ec0bb7bd20647490a29ed53fa694a965f774aa86f5576b727b4aa4a21878b111919082b8b175d3ec0c91f7c6d95679b0f49c75484c0e38ab9dd106804028f058457c0631b0065415590e0a979ed2dfea5d527ab2db47a0667e208a8e2c49936af1e716994fddd1534c77cba484532267ca3499ff036e15cf5f34d483d971cf25371a21b02a0dd16086270d4ff3ac9e7bdccf23d8332e1665c7d459676dfd2038cdc6366f31b64709c31d2a107960741ba86ff24b03651843836d48f88e8a0cc30cd9533d98f06209b7369925b504e0c83eb9dfaae80a2b9284fd0d0764cbff2cefb4d4a5c93d1c60a581d7e8b2c7606c15cee53c11874a365c9e4aa2d8f3526959591e207a66ad0ca5f8d9a938754978f2a1e093bc093706f180ef3a30c8b54ce8b739255873a6cddc8837ff317ae8cad2a5cb0efe209daf82b8a8c35207e09a4c7fdcc72d6e03998e930138bbb8f30447074252206b7260df5096671679ce48045b70d1f9c503cd9e6d03c79243a70b21cfdde0d6526e5f3f4e54091decb4634afe7ba5904fdbdaa2734b84ebe1fc412d63632f7fb3b6d5e3ca2daf35bad63b34869774a48b9c5a602a5c924301f2b4d9caa1860dbf652e61b7677bc90dc324bd52a7ee1c18887aee16a8d861b2bb09debb05ce2e9b859472c04dee1747be7d0b05eac85d28e65636da8139e2c6f5f0b83169ac4bf34fc8952ba51406f3b2c64f955d014a1db46a769d258035d9ef766add4447bb30b861b5edf488b4f871b055cb21f40774de3c4b1dc83723b664949f37fa7ba76699c158a8b171a7b62df6850b22afebb3a4347e1a360998c5b0a78f1dec1e4b300912410ef734a10e22181e9da3ff94d9d628857bf20af0f9c3c626cc86a62b83e317becb9cafb7b7111c7a5b40da7c3c643ff1a24125267b6047eab336d8ab85844e17b95e8d1c4caae64e09468d0e9446aa64bf3cf59cad9f789fbaeff9feb4b9f2220a3e803077f857fe10e8b9ee30849219837f1c8b3e2623dd5cf3093fa5a5a91e0d57e8439c1c041b3adf6d8be5c49e08aeb6c323518bde51a8c0643cf8f865ae30b55f4797fda0d6c010f1cce7033a88666f2710b6a638efcba9787ab66884ab088340f1bcf34b002bb94ecffd3a6ccc77b55e6c75136d4200ecfe1db539e4625662ef90993045a0069cf544937e6ee93bc65bc138a3d3dceb92dfd6080d4fedef749a187b29696900bbb7c9829c6c229de93bcc917604588edc09f06da5bbdbc1ab24d60814aed01030e297d82ccd6fd427580c3d8187c7d538145827ad3898efa4aaa8b43bb662b4a7a773e124c3c7f661ad4e8e2fa5c8c9686edef9386d2e63595c23d88c91618be060fa4075b7a3e9acc99520b90ed55a40771afdce2a35bc325d917ce0f4ad60bd553a2e86423b5c40a27566067a75c395f66be0c278f9e791af9114812a64117913a37bf7122e1c1c15cd43bafb082c5dc781717830e50d4a8f3af6a0ac54924d7118a2d7fe24b31190a3bcf79356976947c149e2c1e64bce07f1431918fd6418367782c1183aca213a2b0caf8f3fa0a56aa1763b9570ef659df6e84c9a38d43b404b257812992674cad1182b3ef0edfaad60828e718d2e524fee1a07bfb4dcae5b0e6d61288d3b99b897d86e3dca337ccdd1fbdef949e8ccba03aad6a21df39554bf43dba842a8a1ead0271fa79a27683b359486fbec0ad69620f891a3106dcfb6a1884893d24e88ce56175fed9e7e031cb1d54bdd5d3746fe816069bbb5ffbea7d51f76fefae4e0d0b87b795cccc7ed9d9076ee7b16b1f5520a9f61874fd01e0655d635f007d783da29aa513abd7f6d6fa1eafa8eb722c119c6864732392e89659142f9dc2cd32bdeacdf25d5100f83ef0ad1834f553e423604ec147fdb127faa8683b8820c7ce5d62dd0a42a80e42cdf5981943584df4dc6d1da82e11ebe0d9b94516c37bdf6c533ddb0801ec6cce7e45a786976ccac3ee3d31a384c23a737d248b16c53dd74bfef86a88ad9a36a8ba2d1e3c9950da0cb8c0cb611aac43c7463f32f6fe84356ddaf1259") # enc flag

def get_key_from_SID(SID):
    key = b''
    key += p64le(SID[0] ^ 0x676e702e67616c66)
    key += p64le(SID[1] ^ 0x676e702e67616c66)
    return key

def get_iv_from_SID(SID):
    iv = b''
    iv += p64le((SID[0] ^ 0x676e702e67616c66) ^ 0xeff005d9999c197c)
    iv += p64le((SID[1] ^ 0x676e702e67616c66) ^ 0xb49350cc51b6a860)
    return iv

if __name__ == "__main__":
    regs_after_first_bytecode = [0xe5829fb3efa4a50d, 0x51db324eae8b8e74, 0x26133be822eddc1d, 0x3677dfb1ee1875a9]

    key = [u64le(first_packet[:8]), u64le(first_packet[8:16])]
    enc_sid = [u64le(first_packet[16:24]), u64le(first_packet[24:32]), u64le(first_packet[32:40]), u64le(first_packet[40:48])]

    tmp = [0, 0, 0, 0]
    for i in range(4):
        tmp[i] = (key[i % 2] ^ enc_sid[i]) ^ regs_after_first_bytecode[i]
        
    AESkey = get_key_from_SID(tmp[:2])
    AESiv = get_iv_from_SID(tmp[:2])

    ctx = AES.new(AESkey, AES.MODE_CBC, iv=AESiv)
    out = ctx.decrypt(second_packet)

    fd = open("test_decrypt.png", 'wb')
    fd.write(out)
    fd.close()
