# Reverse | easy | Solid Snake

## Информация

> Наш секретный агент недавно прибыл в город для разведывания обстановки. 
> 
> В своём первом докладе он сообщил о проблемах с его интерактивной консолью.
>
> Кажется она реализует не весь функционал. 
>
> Проверь её на наличие дополнительных возможностей, может удастся что-то разблокировать.
> 
> Агент прислал нам лишь этот файл.


## Деплой

Не требуется

## Выдать участинкам

Архив из директории pulibc/

## Описание

ELF 64bit, python3 executable

Смысл таска заключается в поиске бинарного патча, которые добавляет некоторую дополнительную функцию в интерактивный шелл Python.

## Решение

1. При загрузке файла в дизассемблер можно понять, что перед нами действительно обычный Python3 с символьной информацией
2. Нам сказано про дополнительные команды, значит стоит поискать где может происходить обработка команды
3. Первое на что стоит обратить внимание это уровень на котором читаются данные из интерактивной консоли
4. Находим функцию `PyOS_Readline` и в её конце видим сравнение введёных данных с строкой `unlock("`
5. Переходим в код, который будет вызыван при срабатывании этого сравнения (функция `sub_6A8E1B`)
6. После анализа функции можно понять, что сначала проверяется оставшася часть строки, а аргумент функции `unlock()` шифруется и проверяется с некоторой заложенной последовательностью
7. Функция `sub_6A8D17` реализует вызов функции шифрования введёной строки и её проверку с массивом в памяти. В случае успешной проверки будет выведено сообщение "CORRECT"
8. Функция `sub_6A8C6D` реализует алгоритм шифрования. В качестве ключа используются первые 16 байт заголовка исполняемого файла
9. Реализуем функцию расшифрования, т.к. у нас есть ключ и шифротекст.

[Пример расшифровки](solution/main.c)

## Флаг

`CUP{5a94d24a168fbabd80769d6756ed6f35}`
