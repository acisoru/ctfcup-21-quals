# Pwn | hard | Secure Notes 2

## Информация

> Кто-то явно любит делать свои заметки безопасными.
>
> В этом сервисе они размещаются прямо в ядре.
>
> Сможешь ли ты получить секретную заметку?
>
> *файлы задания и порт аналогичны заданию Secure Notes 1, в этой задаче нужно прочитать файл /root/flag.txt*
> 
> `nc <ip> 17106`
>

## Деплой

Деплоится один раз на оба таска

```sh
cd deploy
docker-compose up --build -d
```

## Выдать участинкам

Архив из директории [public/](public/) и IP:PORT сервера

## Описание

Linux kernel PWN, уязвимость заключается в возможности читать данные произвольного размера с ядерной кучи, а также перезаписывать данные на куче.

## Решение

1. Чтобы прочитать скрытую заметку нужно просто получить примитив AR на куче
2. В функции `get` мы можем читать память любого размера, это уже даёт нам утечку памяти, однако нужный чанк может находиться выше
3. В функции `update` мы можем переписать данные на куче и таким образом переписать и часть указателя по которому читаются данные
4. Манипулируя указателем и производя чтение памяти можно сделать сканирование всей памяти кучи в обе стороны
5. Во время сканирования будем искать структуру `task_struct` в которой хранятся текущии привелегии процесса
6. Как только найдём - переписываем на 0, чтобы получить root

[Эксплоит](solution/priv_esc.c)

## Флаг

`CUP{af2acad03f43c6772c61a50986949512}`